---
import { SITE_SHORT_TITLE } from "../config";
---

<!-- Inline script to run IMMEDIATELY before any content renders -->
<script is:inline>
  // Check if intro has been shown (use sessionStorage so it shows on hard refresh)
  const hasSeenIntro = sessionStorage.getItem("introDone");
  if (!hasSeenIntro) {
    // Hide body content immediately and show splash screen
    document.documentElement.style.visibility = "hidden";
  }
</script>

<div id="splash-screen" class="splash-screen">
  <div class="logo-wrapper">
    <div class="name">{SITE_SHORT_TITLE}</div>
  </div>
</div>

<script is:inline>
  (function () {
    // Check if intro has been shown (use sessionStorage so it shows on hard refresh)
    const hasSeenIntro = sessionStorage.getItem("introDone");
    const splashScreen = document.getElementById("splash-screen");

    if (!hasSeenIntro && splashScreen) {
      // Make HTML visible but keep body content hidden
      document.documentElement.style.visibility = "visible";

      // Add class to body to prevent scrolling and enable pointer events
      document.body.classList.add("splashScreen");
      splashScreen.classList.add("active");

      // Elegant animation sequence
      const animateIntro = async () => {
        const name = splashScreen.querySelector(".name");

        // Fade in background smoothly
        splashScreen.style.transition = "opacity 0.4s ease-out";
        splashScreen.style.opacity = "1";

        // Wait a moment, then reveal text with upward slide effect
        await new Promise((resolve) => setTimeout(resolve, 300));
        if (name) {
          name.style.opacity = "1";
          name.style.transform = "translateY(0)";
        }

        // Let the user appreciate the logo for a moment
        await new Promise((resolve) => setTimeout(resolve, 1200));

        // Fade out text first
        if (name) {
          name.style.transition =
            "opacity 0.5s ease-out, transform 0.5s ease-out";
          name.style.opacity = "0";
          name.style.transform = "translateY(-20px)";
        }

        // Slide down the entire screen elegantly
        await new Promise((resolve) => setTimeout(resolve, 300));
        splashScreen.style.transition =
          "transform 0.8s cubic-bezier(0.65, 0, 0.35, 1)";
        splashScreen.style.transform = "translateY(100%)";

        // Cleanup after animation completes
        await new Promise((resolve) => setTimeout(resolve, 800));
        document.body.classList.remove("splashScreen");
        splashScreen.classList.remove("active");
        splashScreen.style.display = "none";

        // Mark intro as done for this session
        sessionStorage.setItem("introDone", "true");
      };

      animateIntro();
    } else {
      // If already seen, show page immediately
      document.documentElement.style.visibility = "visible";
      if (splashScreen) {
        splashScreen.style.display = "none";
      }
    }
  })();
</script>

<style>
  .splash-screen {
    position: fixed;
    top: 0;
    left: 0%;
    z-index: 900;
    height: 100%;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: var(--color-background);
    opacity: 0;
    pointer-events: none;
    transform: translateY(0);
  }

  .splash-screen.active {
    pointer-events: all;
  }

  .logo-wrapper {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    width: auto;
    height: auto;
  }

  .name {
    color: var(--color-primary);
    font-size: 2em;
    font-weight: 500;
    opacity: 0;
    transform: translateY(30px);
    transition:
      opacity 0.9s cubic-bezier(0.16, 1, 0.3, 1),
      transform 0.9s cubic-bezier(0.16, 1, 0.3, 1);
  }
</style>
