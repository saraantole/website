---
import heroImage from "../assets/result_01.jpg";

const adjectives = [
  "Product engineer",
  "AI-native",
  "Human-first",
  "Experiment-driven",
];
---

<section id="hero" class="hero">
  <div
    class="hero-bg-blurred"
    style={`background-image: url(${heroImage.src});`}
  >
  </div>
  <div class="hero-bg-clear" style={`background-image: url(${heroImage.src});`}>
  </div>
  <div class="hero-border"></div>
  <div class="hero-plus">+</div>
  <div class="hero-overlay"></div>
  <div class="hero-center-content">
    {
      adjectives.map((adj, index) => (
        <div
          class="hero-text"
          style={`animation-delay: ${2.4 + index * 0.15}s`}
        >
          {adj}
        </div>
      ))
    }
  </div>
  <div class="hero-content">
    <h1 class="title">Sara Antole</h1>
  </div>
</section>

<style is:global>
  .hero {
    width: 100%;
    min-height: 100vh;
    overflow: hidden;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-text);
  }

  .hero-bg-blurred {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    filter: blur(6px) grayscale(100%);
    z-index: 0;
    opacity: 0;
    transform: scale(1.05);
    animation: heroImageReveal 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  .hero-bg-clear {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    filter: grayscale(40%);
    clip-path: inset(0% 0% 0% 0%);
    z-index: 1;
    opacity: 0;
    transform: scale(1.05);
    animation:
      heroImageReveal 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards,
      shrinkSquare 1s cubic-bezier(0.4, 0, 0.2, 1) 1.2s forwards;
  }

  @keyframes shrinkSquare {
    to {
      clip-path: inset(20% 42.5% 50% 42.5%);
    }
  }

  .hero-border {
    position: absolute;
    top: 0%;
    left: 0%;
    right: 0%;
    bottom: 0%;
    border: 1px solid var(--color-tertiary);
    z-index: 2;
    pointer-events: none;
    opacity: 0;
    animation: shrinkBorder 1s cubic-bezier(0.4, 0, 0.2, 1) 1.2s forwards;
  }

  @keyframes shrinkBorder {
    0% {
      opacity: 1;
      top: 0%;
      left: 0%;
      right: 0%;
      bottom: 0%;
    }
    100% {
      opacity: 1;
      top: 20%;
      left: 42.5%;
      right: 42.5%;
      bottom: 50%;
    }
  }

  .hero-plus {
    position: absolute;
    top: 35%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--color-tertiary);
    font-size: 30px;
    font-weight: 300;
    z-index: 2;
    pointer-events: none;
    opacity: 0;
    animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) 1.2s forwards;
  }

  @keyframes heroImageReveal {
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @media (max-width: 991px) {
    .hero {
      margin-top: 0;
      padding-top: 0;
    }

    @keyframes shrinkSquare {
      to {
        clip-path: inset(20% 20% 50% 20%);
      }
    }

    @keyframes shrinkBorder {
      0% {
        opacity: 1;
        top: 0%;
        left: 0%;
        right: 0%;
        bottom: 0%;
      }
      100% {
        opacity: 1;
        top: 20%;
        left: 20%;
        right: 20%;
        bottom: 50%;
      }
    }

    .hero-plus {
      top: 35%;
    }

    .hero-center-content {
      flex-direction: column;
      gap: 0.5rem;
      padding: 0 2rem;
      top: 60% !important;
      transform: translateY(0) !important;
    }
  }

  .hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.3);
    z-index: 1;
    opacity: 0;
    animation: fadeIn 0.8s ease-out 0.4s forwards;
  }

  .hero-center-content {
    position: absolute;
    top: 55%;
    left: 0;
    right: 0;
    transform: translateY(-50%);
    z-index: 2;
    display: flex;
    padding: 0 2rem;
    align-items: center;
    justify-content: space-between;
    width: 100%;
  }

  .hero-text {
    font-family: var(--font-primary);
    font-size: 14px;
    font-weight: 600;
    color: var(--color-background);
    white-space: nowrap;
    text-transform: uppercase;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }

  .hero-content {
    width: 100%;
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 2;
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 1s cubic-bezier(0.4, 0, 0.2, 1) 1.4s forwards;
  }

  .hero .title {
    font-family: var(--font-primary);
    font-size: clamp(18px, 18vw, 320px);
    font-weight: 500 !important;
    margin: 0;
    line-height: 1;
    color: var(--color-background);
    text-align: center;
    width: 100%;
  }
</style>

<script>
  function initHeroMouseMove() {
    const hero = document.getElementById("hero");
    const header = document.getElementById("header");
    const clearBg = document.querySelector(".hero-bg-clear") as HTMLElement;
    const border = document.querySelector(".hero-border") as HTMLElement;
    const plus = document.querySelector(".hero-plus") as HTMLElement;

    if (!hero || !clearBg || !border || !plus) return;

    // Only enable on desktop
    const isDesktop = window.innerWidth >= 992;
    if (!isDesktop) return;

    // Reset animations to ensure they play from the beginning
    clearBg.style.animation = "";
    border.style.animation = "";
    plus.style.animation = "";
    clearBg.style.opacity = "";
    clearBg.style.transform = "";
    clearBg.style.clipPath = "";
    border.style.top = "";
    border.style.left = "";
    border.style.right = "";
    border.style.bottom = "";
    border.style.opacity = "";
    plus.style.opacity = "";

    // Wait for animations to complete before enabling mouse tracking
    setTimeout(() => {
      // Remove animations so JavaScript can take control
      clearBg.style.animation = "none";
      border.style.animation = "none";
      plus.style.animation = "none";

      // Set initial position explicitly
      clearBg.style.opacity = "1";
      clearBg.style.transform = "scale(1)";
      clearBg.style.clipPath = "inset(20% 42.5% 50% 42.5%)";
      border.style.top = "20%";
      border.style.left = "42.5%";
      border.style.right = "42.5%";
      border.style.bottom = "50%";
      border.style.opacity = "1";
      plus.style.opacity = "1";

      hero.addEventListener("mousemove", (e: MouseEvent) => {
        const rect = hero.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        const centerX = (x / rect.width) * 100;
        const centerY = (y / rect.height) * 100;

        // Calculate inset values to keep the square centered on cursor
        const squareWidth = 15; // 15% width
        const squareHeight = 30; // 30% height

        // Calculate header height as percentage of hero height
        let minTop = 0;
        if (header) {
          const headerHeight = header.offsetHeight;
          const heroHeight = hero.offsetHeight;
          minTop = (headerHeight / heroHeight) * 100;
        }

        const top = Math.max(
          minTop,
          Math.min(100 - squareHeight, centerY - squareHeight / 2),
        );
        const left = Math.max(
          0,
          Math.min(100 - squareWidth, centerX - squareWidth / 2),
        );
        const bottom = 100 - top - squareHeight;
        const right = 100 - left - squareWidth;

        clearBg.style.clipPath = `inset(${top}% ${right}% ${bottom}% ${left}%)`;
        border.style.top = `${top}%`;
        border.style.left = `${left}%`;
        border.style.right = `${right}%`;
        border.style.bottom = `${bottom}%`;
        plus.style.top = `${top + squareHeight / 2}%`;
        plus.style.left = `${left + squareWidth / 2}%`;
      });
    }, 2200); // Enable after text animations complete (2.2s)
  }

  // Run on page load
  initHeroMouseMove();

  // Re-run after Astro view transitions
  document.addEventListener("astro:page-load", initHeroMouseMove);
</script>
